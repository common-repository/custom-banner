jQuery(document).ready(function(t){let e=t(".custom-banner-preview-wrapper"),n=t(".custom-banner-preview-wrapper").find(".custom-banner-preview");function a(){let a=t("#wpadminbar").height(),o=t("#wpcontent").width()+"px",l=e.offset().top-a;t(window).scrollTop()>l?(e.height(n.height()),n.addClass("fixed"),n.css("top",a),n.css("width",o)):(n.removeClass("fixed"),n.css("top","unset"),n.css("width","100%"))}a(),t(window).scroll(function(){a()}),t(window).resize(function(){a()});let o=0;function l(){t(".custom-banner-preview").addClass("loading");let e=++o;setTimeout(function(){var n;let l={action:"custom_banner_update_preview",nonce:customBannerAjax.nonce,custom_banner_enable:t('input[name="custom_banner_enable"]').is(":checked")?1:0,custom_banner_text_color:t('input[name="custom_banner_text_color"]').val(),custom_banner_background_color:t('input[name="custom_banner_background_color"]').val(),custom_banner_width:t('input[name="custom_banner_width"]:checked').val(),custom_banner_arrows:t('input[name="custom_banner_arrows"]:checked').val(),custom_banner_content:(n=[],t("#custom-banner-content-table tr").each(function(){var e=t(this),a={type:e.find('select[name^="custom_banner_banner_text"][name$="[type]"]').val(),text:e.find('input[name^="custom_banner_banner_text"][name$="[text]"]').val(),link_text:e.find('input[name^="custom_banner_banner_text"][name$="[link_text]"]').val(),url:e.find('input[name^="custom_banner_banner_text"][name$="[url]"]').val(),show_link:e.find('input[name^="custom_banner_banner_text"][name$="[show_link]"]').is(":checked")?"on":"off"};"html"===a.type&&(a.text=e.find('textarea[name^="custom_banner_banner_text"][name$="[text]"]').val(),a.text=unescape(a.text),delete a.link_text,delete a.url,delete a.show_link),n.push(a)}),n),custom_banner_css_class:t('input[name="custom_banner_css_class"]').val(),custom_banner_autoplay:t('input[name="custom_banner_autoplay"]').is(":checked")?"on":"",custom_banner_delay:t('input[name="custom_banner_delay"]').val()};t.post(customBannerAjax.ajaxUrl,l,function(n){var l=null;let s,c,r;e===o&&(t(".custom-banner-preview").removeClass("loading"),t(".custom-banner-preview").html(n),a(),null!=l&&l.destroy(!0,!0),s=t('input[name="custom_banner_autoplay"]').is(":checked")?"on":"",c=t('input[name="custom_banner_delay"]').val(),r={direction:"horizontal",speed:400,loop:!0,navigation:{nextEl:".banner-next",prevEl:".banner-prev"}},"on"!==s||isNaN(c)||(r.autoplay={delay:1e3*c,disableOnInteraction:!1}),l=new Swiper(".bannerSwiper",r))})},100)}l(),t(document).on("change",".custom-banner-settings-wrap input:not(.wp-picker-default):not([name=custom_banner_enable]), .custom-banner-settings-wrap textarea",function(){l()}),t(".custom-banner-color-field").wpColorPicker({change:function(){l()}}),t(document).on("click",function(e){t(e.target).closest(".wp-picker-container").length||t(e.target).is(".wp-color-picker, .wp-color-result")||t(".custom-banner-color-field").iris("hide")}),t(".wp-color-picker").on("click",function(e){t(".custom-banner-color-field").iris("hide"),t(e.target).closest(".custom-banner-color-field").iris("show")}),t(".wp-color-result").on("click",function(e){t(".custom-banner-color-field").iris("hide")}),t("#cbAddMore").click(function(){var e=t("#custom-banner-content-table tr").length,n='<tr><td><label>Type</label><select name="custom_banner_banner_text['+e+'][type]" class="Type"><option value="simple">Simple</option><option value="html">HTML</option></select></td>';n+='<td class="message"><label>Text</label><input type="text" name="custom_banner_banner_text['+e+'][text]"></td>',n+='<td><label>Link Text</label><input type="text" name="custom_banner_banner_text['+e+'][link_text]"></td>',n+='<td><label>URL</label><input type="text" name="custom_banner_banner_text['+e+'][url]"></td>',n+='<td class="switch"><label>Show Link</label><input type="checkbox" name="custom_banner_banner_text['+e+'][show_link]" checked="checked"></td>',n+='<td><button type="button" class="remove-row"><span class="minus"></span></button></td></tr>',t("#custom-banner-content-table").append(n),l()}),t(document).on("click","#custom-banner-content-table .remove-row",function(){t(this).closest("tr").remove(),t("#custom-banner-content-table tr").each(function(e){t(this).find("select, textarea, input").each(function(){var n=t(this).attr("name").match(/(\w+)\[(\d+)\](\[\w+\])/);n&&t(this).attr("name",n[1]+"["+e+"]"+n[3])})}),l()}),t("#custom-banner-content-table").on("change",".type",function(){var e=t(this).closest("tr"),n=e.index(),a=t(this).val(),o='<td><label>Type</label><select name="custom_banner_banner_text['+n+'][type]" class="type">';"html"===a?(o+='<option value="simple">Simple</option><option value="html" selected>HTML</option></select></td>',o+='<td class="html"><label>HTML</label><textarea onInput="textAreaAdjust(this)" name="custom_banner_banner_text['+n+'][text]"></textarea></td>'):(o+='<option value="simple" selected>Simple</option><option value="html">HTML</option></select></td>',o+='<td class="message"><label>Text</label><input type="text" name="custom_banner_banner_text['+n+'][text]"></td>',o+='<td><label>Link Text</label><input type="text" name="custom_banner_banner_text['+n+'][link_text]"></td>',o+='<td><label>URL</label><input type="text" name="custom_banner_banner_text['+n+'][url]"></td>',o+='<td class="switch"><label>Show Link</label><input type="checkbox" name="custom_banner_banner_text['+n+'][show_link]"></td>'),o+='<td><button type="button" class="remove-row"><span class="minus"></span></button></td>',e.html(o),l()}),t(".custom-banner-number-field").each(function(){var e=t(this).find("button.minus-btn"),n=t(this).find("button.plus-btn"),a=t(this).find('input[type="number"]');e.click(function(){var t=parseInt(a.val(),10)||0;t>parseInt(a.attr("min"),10)&&(a.val(t-1),a.trigger("change"))}),n.click(function(){var t=parseInt(a.val(),10)||0;t<parseInt(a.attr("max"),10)&&(a.val(t+1),a.trigger("change"))})}),t(".custom-banner-adv-settings .form-table").css("display","none"),t(".custom-banner-adv-settings h2").on("click",function(){var e=t(this).parent(".custom-banner-adv-settings");e.toggleClass("open"),e.hasClass("open")?t(this).next(".form-table").slideDown():t(this).next(".form-table").slideUp()})});